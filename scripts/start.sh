#!/bin/bash
cd /home/ubuntu/Banana-market/server

export DATABASE_USERNAME=$(aws ssm get-parameters --region ap-northeast-2 --names DATABASE_USERNAME --query Parameters[0].Value | sed 's/"//g')
export DATABASE_PASSWORD=$(aws ssm get-parameters --region ap-northeast-2 --names DATABASE_PASSWORD --query Parameters[0].Value | sed 's/"//g')
export DATABASE_PORT=$(aws ssm get-parameters --region ap-northeast-2 --names DATABASE_PORT --query Parameters[0].Value | sed 's/"//g')
export DATABASE_HOST=$(aws ssm get-parameters --region ap-northeast-2 --names DATABASE_HOST --query Parameters[0].Value | sed 's/"//g')
export DATABASE_NAME=$(aws ssm get-parameters --region ap-northeast-2 --names DATABASE_NAME --query Parameters[0].Value | sed 's/"//g')

export HTTP_PORT=$(aws ssm get-parameters --region ap-northeast-2 --names HTTP_PORT --query Parameters[0].Value | sed 's/"//g')

export ACCESS_SECRET=$(aws ssm get-parameters --region ap-northeast-2 --names ACCESS_SECRET --query Parameters[0].Value | sed 's/"//g')
export REFRESH_SECRET=$(aws ssm get-parameters --region ap-northeast-2 --names REFRESH_SECRET --query Parameters[0].Value | sed 's/"//g')

export GOOGLE_CLIENT_ID=$(aws ssm get-parameters --region ap-northeast-2 --names GOOGLE_CLIENT_ID --query Parameters[0].Value | sed 's/"//g')
export GOOGLE_CLIENT_SECRET=$(aws ssm get-parameters --region ap-northeast-2 --names GOOGLE_CLIENT_SECRET --query Parameters[0].Value | sed 's/"//g')
export GOOGLE_REDIRECT_URI=$(aws ssm get-parameters --region ap-northeast-2 --names GOOGLE_REDIRECT_URI --query Parameters[0].Value | sed 's/"//g')

export EMAIL=$(aws ssm get-parameters --region ap-northeast-2 --names EMAIL --query Parameters[0].Value | sed 's/"//g')
export PASSWORD=$(aws ssm get-parameters --region ap-northeast-2 --names PASSWORD --query Parameters[0].Value | sed 's/"//g')

export AKEY=$(aws ssm get-parameters --region ap-northeast-2 --names AKEY --query Parameters[0].Value | sed 's/"//g')
export ASECRET=$(aws ssm get-parameters --region ap-northeast-2 --names ASECRET --query Parameters[0].Value | sed 's/"//g')


sleep 10s && pm2 status // pm2동작을 확인 - 제대로 작동했는지, codedeploy ->로그 확인
echo $DATABASE_HOST     // 환경변수에 DATABASE_HOST의 값이 무엇인지 확인
node check.js           // 만드신 check.js의 로그가 자동화 과정에서는 어떤 console.log를 보여주는지 확인

authbind --deep pm2 start index.js